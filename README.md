# 🤖 滴灌通智能体筛选系统 (DGT Intelligence Platform)

## 项目概述
- **名称**: 滴灌通智能体筛选系统
- **目标**: 构建真正接入大模型的多智能体投资评估系统
- **模式**: 双层漏斗模型（外环一票否决 + 中环加权评分）

## 🌐 在线访问
- **Sandbox URL**: https://3000-isamie14vn6sqeukq0ano-c07dda5e.sandbox.novita.ai

## 📊 功能特性

### 已完成功能 ✅

1. **10个智能体配置（真实AI接入）**
   - 外环智能体（3个）: 负面清单、触达审核、利益一致性初筛
   - 中环智能体（7个）: 财务健康度、运营能力、法律合规、风险控制、利益一致性深度、经济性测算、综合评分
   - 所有智能体均真实调用大模型（gpt-5-mini）

2. **外环智能体 - 通用初筛（已优化）**
   - ✅ 移除行业细节规则，改为通用初筛
   - ✅ 负面清单：只检查绝对禁止项（博彩、非法金融、传销等）
   - ✅ 触达智能体：检查通用材料完整性（企业信息、业务描述、财务数据、项目材料）
   - ✅ 利益一致性：检查分配机制基本逻辑
   - ✅ Cardi B 演示项目已验证全部通过外环

3. **中环智能体 - 行业深度评估**
   - 演唱会行业规则已迁移到中环
   - 财务健康度：包含演唱会票房预测、成本结构评估标准
   - 运营能力：包含涉外演出资质、大型活动经验评估
   - 法律合规：包含文旅部批文、公安备案、艺人合同审查要点
   - 风险控制：包含艺人取消风险、票房风险评估清单

4. **评估结果带详细解释**
   - ✅ 所有智能体的评估结果包含 `reasoning` 字段
   - ✅ 详细说明：打分依据、评估逻辑、优缺点分析、通过/不通过原因
   - ✅ max_tokens 增加到 4000 确保完整输出

5. **评估过程可视化（v1.2.0新增）**
   - ✅ 每个智能体卡片可展开查看详细评估步骤
   - ✅ 实时显示AI推理过程（执行中/已完成状态切换）
   - ✅ 风险等级标签（低风险/中风险/高风险）
   - ✅ 检查发现列表（findings）
   - ✅ 评估建议展示（recommendation）
   - ✅ 完整评估报告弹窗（含原始JSON数据）
   - ✅ "展开/收起全部"快捷按钮
   - ✅ 外环串行执行说明（一票否决机制）
   - ✅ 中环并行执行说明（加权评分机制）
   - ✅ 综合评分加权公式实时展示

6. **智能体配置中心** (`/agents`)
   - System Prompt在线编辑
   - 知识库在线编辑和上传
   - 评估标准JSON编辑
   - 参数配置（权重、阈值、执行顺序）
   - AI模型配置（模型、Temperature、Max Tokens）
   - 测试运行功能

7. **Demo演示页面** (`/demo`)
   - Cardi B演唱会项目完整评估演示
   - 外环串行执行动画（含实时推理展示）
   - 中环并行执行动画（含实时推理展示）
   - 雷达图评分展示
   - 最终投资建议
   - 点击智能体卡片可展开查看详细评估过程
   - 支持查看完整评估报告

8. **其他页面**
   - Dashboard主页 (`/`)
   - 工作流可视化 (`/workflow`)
   - 标的管理 (`/deals`)
   - 4步提交表单 (`/submit`)

### API端点

| 端点 | 方法 | 功能 |
|------|------|------|
| `/api/init-db` | POST | 初始化数据库 |
| `/api/agents` | GET | 获取所有智能体 |
| `/api/agents/:id` | GET/PATCH | 获取/更新单个智能体 |
| `/api/deals` | GET/POST | 获取所有标的/创建标的 |
| `/api/deals/:id` | GET/PATCH | 获取/更新单个标的 |
| `/api/workflow` | GET | 获取工作流配置 |
| `/api/evaluation-logs/:dealId` | GET | 获取评估日志 |
| `/api/ai/evaluate` | POST | 执行单个智能体评估 |
| `/api/ai/evaluate-deal` | POST | 执行完整评估流程 |
| `/api/stats` | GET | 获取统计数据 |
| `/api/debug-env` | GET | 检查环境变量配置 |

## 🎯 外环评估结果（Cardi B项目）

| 智能体 | 分数 | 状态 | 说明 |
|--------|------|------|------|
| 负面清单智能体 | 95-100 | ✅ 通过 | 业务属于正常文化活动，无禁止项 |
| 触达智能体群 | 69-74 | ✅ 通过 | 材料基本齐全，需补充部分信息 |
| 利益一致性初筛 | 62-72 | ✅ 通过 | 分配机制存在，需中环深入评估 |

## 🗄️ 数据架构

### 数据库表
1. **deals** - 投资标的
2. **agents** - 智能体配置（核心表）
3. **evaluation_logs** - 评估日志
4. **workflow** - 工作流配置

### 存储服务
- **Cloudflare D1** - SQLite数据库

## 🚀 技术栈
- **后端**: Hono + TypeScript
- **数据库**: Cloudflare D1
- **AI**: OpenAI API (gpt-5-mini)
- **前端**: TailwindCSS + Chart.js + Marked.js
- **部署**: Cloudflare Pages

## 📦 本地开发

```bash
# 安装依赖
npm install

# 初始化数据库
npx wrangler d1 migrations apply dgt-db --local

# 构建项目
npm run build

# 启动开发服务器
npm run dev:sandbox
# 或使用PM2
pm2 start ecosystem.config.cjs
```

## 🔐 环境变量
- `OPENAI_API_KEY` - OpenAI API密钥
- `OPENAI_BASE_URL` - OpenAI API基础URL

在 `.dev.vars` 文件中配置：
```
OPENAI_API_KEY=your-api-key
OPENAI_BASE_URL=https://www.genspark.ai/api/llm_proxy/v1
```

## 📅 更新日志

- **2026-01-14 v1.2.0**: 评估过程可视化增强（工作流解释功能）
  - ✅ 智能体卡片支持展开/收起，显示评估详情
  - ✅ 实时显示AI推理过程（执行中动画→完成后展示结果）
  - ✅ 风险等级标签可视化（低/中/高风险）
  - ✅ 检查发现（findings）列表展示
  - ✅ 评估建议（recommendation）展示
  - ✅ "查看完整评估报告"弹窗（含原始JSON数据）
  - ✅ "展开/收起全部"快捷按钮
  - ✅ 外环/中环执行机制说明（一票否决/加权评分）
  - ✅ 综合评分区域显示加权计算公式详情
  - ✅ 投资建议自动从评估结果提取优势和风险点
  - ✅ 评估完成后自动展开详情面板

- **2026-01-13 v1.1.0**: 外环智能体优化
  - 外环智能体简化为通用初筛，移除行业细节
  - 演唱会行业规则迁移到中环智能体
  - 所有评估结果包含详细reasoning解释
  - max_tokens 增加到 4000
  - Cardi B 项目验证外环全部通过

- **2026-01-13 v1.0.0**: 初始版本发布
  - 完成10个智能体配置
  - 完成6个页面开发
  - 集成OpenAI API
  - Cardi B项目演示数据

## 📝 使用指南

### 1. 查看智能体配置
访问 `/agents` 页面，可以：
- 切换查看外环/中环智能体
- 点击智能体卡片编辑配置
- 修改System Prompt和知识库
- 测试运行智能体

### 2. 运行评估演示
访问 `/demo` 页面，点击"开始评估"按钮：
- 系统将依次执行外环筛选（一票否决）
- 然后并行执行中环评估
- 最后显示综合评分和投资建议
- 每个智能体约需30-45秒，完整流程需几分钟

**🆕 v1.2.0 新功能 - 评估过程可视化**
- 点击智能体卡片展开/收起查看详细评估过程
- 外环筛选：实时显示筛查步骤、推理过程、风险等级、检查发现
- 中环评估：展示各维度的深度分析、打分依据、评估建议
- 综合评分：展示加权计算公式和各维度分数贡献
- 投资建议：自动从AI评估结果提取优势和风险点
- 支持"展开/收起全部"快捷操作
- 可查看每个智能体的完整评估报告（含原始JSON数据）

### 3. 提交新标的
访问 `/submit` 页面：
- 选择行业类型
- 填写企业基本信息
- 上传项目材料
- 确认提交

## 📌 架构说明

### 外环智能体（通用初筛，一票否决）
```
用户 → 负面清单(串行) → 触达审核(串行) → 利益一致性(串行) → 中环
        ↓ 不通过           ↓ 不通过           ↓ 不通过
        终止               终止               终止
```

### 中环智能体（行业深度评估，加权评分）
```
中环入口 → [财务健康(25%)]
        → [运营能力(20%)]     → 综合评分 → 投资建议
        → [法律合规(15%)]        (加权)
        → [风险控制(15%)]
        → [利益深度(10%)]
        → [经济测算(10%)]
```

## 📌 下一步计划
- [x] ~~评估过程解释可视化~~ (v1.2.0已完成)
- [ ] 增加更多行业专属智能体
- [ ] 支持批量评估
- [ ] 添加评估结果导出功能
- [ ] 增加用户权限管理
- [ ] 知识库文件上传功能
- [ ] 评估历史记录与对比
